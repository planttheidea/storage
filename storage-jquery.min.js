/*
 *
 * Copyright 2014 Tony Quetano under the terms of the MIT
 * license found at https://github.com/planttheidea/pledge/MIT_License.txt
 *
 * storage-jquery.js - A mini library to provide a simple API to access Web Storage, with cookies as a fallback
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
*/
(function(g,e,k){function l(a,b){if(a){if(b)return d[b][a];var c=d.local[a],f=d.session[a];if(c)return f?[c,f]:c;if(f)return f}else return b?d[b]:d}function t(a){if(a)if(a.action)switch(a.action){case "get":switch(g.type(a.data)){case "array":for(var b=[],c=0,f=a.data.length;c<f;c++)b.push(l(a.data[c],a.type));return b;case "string":return l(a.data,a.type);case "undefined":return a.type?d[a.type]:d;default:throw Error("Invalid type passed to get, must be either an array or a string.");}case "set":if("object"===
g.type(a.data))for(b in a.data){var c=b,f=a.data[b],e=a.type,e=e||"session";if(c&&f)"string"!==g.type(f)&&(f=JSON.stringify(f)),"local"===e?s.local(c,f):s.session(c,f);else throw Error("Must pass name and value of storage item to assign.");}else throw Error("Invalid type passed to set, must be an object.");break;case "remove":if(b=a.name,a=a.type,b)a?"local"===a?h.local(b):h.session(b):(h.local(b),h.session(b));else if(a)if("local"===a)for(c in d.local)h.local(c);else{if("session"===a)for(c in d.session)h.session(c)}else{for(c in d.local)h.local(c);
for(c in d.session)h.session(c)}}else if(a.name)a.value||l(a.name,a.type);else{if(a.type)return d[a.type]}else return d}var n;try{e.localStorage.setItem("t","t"),e.localStorage.removeItem("t"),n=!0}catch(u){n=!1}var p=n,q;try{e.sessionStorage.setItem("t","t"),e.sessionStorage.removeItem("t"),q=!0}catch(v){q=!1}var r=q,d={local:function(){var a={};if(p)for(var b in e.localStorage){if(b&&null!==b){var c=e.localStorage[b];try{var d=JSON.parse(c),c=d}catch(h){}a[b]=c}}else if(k.cookie)for(var g=k.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,
"").split(/\s*(?:\=[^;]*)?;\s*/),m=0,l=g.length;m<l;m++){g[m]=decodeURIComponent(g[m]);c=decodeURIComponent(k.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(g[m]).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"));try{c=d=JSON.parse(c)}catch(n){}a[b]=c}return a}(),session:function(){var a={};if(r)for(var b in e.localStorage)switch(g.type(b)){case "undefined":case "null":break;default:var c=e.localStorage[b];try{c=JSON.parse(c)}catch(d){}a[b]=c}return a}()},s={local:function(){return p?
function(a,b){a&&a.length&&(d.local[name]=b,e.localStorage.setItem(a,b))}:function(a,b){if(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))return!1;d.local[name]=b;k.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+"; expires=Fri, 31 Dec 9999 23:59:59 GMT";return!0}}(),session:function(){return r?function(a,b){a&a.length&&(d.session[name]=b,e.sessionStorage.setItem(a,b))}:function(a,b){if(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))return!1;d.session[name]=b;k.cookie=encodeURIComponent(a)+
"="+encodeURIComponent(b);return!0}}()},h={local:function(){return p?function(a){d.local[a]&&(delete d.local[a],e.localStorage.removeItem(a))}:function(a){d.local[a]&&(delete d.local[a],k.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT")}}(),session:function(){return r?function(a){d.session[a]&&(delete d.session[a],e.sessionStorage.removeItem(a))}:function(a){d.session[a]&&(delete d.session[a],k.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT")}}()};g.extend({storage:function(a){return t(a)}})})(jQuery,
window,document);
